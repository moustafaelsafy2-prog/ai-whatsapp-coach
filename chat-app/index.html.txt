<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>مدربك الشخصي الذكي | Smart Personal Coach</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <link rel="stylesheet" href="style.css">
</head>
<body class="app-shell">

  <div class="welcome-screen" id="welcomeScreen">
    <div class="absolute top-4 right-4 z-10" style="inset-inline-end: 1rem; inset-inline-start: auto;"><button class="lang-toggle-btn icon-btn text-sm font-bold border !w-auto px-4 !h-10 !rounded-full !border-white/20 hover:!border-accent !text-white bg-white/10 backdrop-blur-sm">AR</button></div>
    <img id="welcomeAvatar" src="https://images.unsplash.com/photo-1581009137042-c552e485697a?auto=format&fit=crop&w=200&q=80" alt="Coach Avatar" class="w-32 h-32 rounded-full mb-6 shadow-xl object-cover border-4 border-[var(--color-accent)]"/>
    <h1 class="text-3xl sm:text-4xl lg:text-5xl font-black mb-2" id="welcomeTitle">مدربك الشخصي الذكي</h1>
    <p class="text-base sm:text-lg lg:text-xl font-light text-white/90 mb-8 max-w-xl" id="welcomeSubtitle">جاهز للتغيير؟ خطتك مصممة خصصًا لك — تنفيذ محكم، متابعة دقيقة، ونتيجة ملموسة.</p>
    <button id="startBtn" class="cta-btn">ابدأ الآن</button>
  </div>

  <div class="user-data-screen hidden" id="userDataScreen">
    <div class="absolute top-4 right-4 z-10" style="inset-inline-end: 1rem; inset-inline-start: auto;"><button class="lang-toggle-btn icon-btn text-sm font-bold border !w-auto px-4 !h-10 !rounded-full !border-white/20 hover:!border-accent !text-white bg-white/10 backdrop-blur-sm">AR</button></div>
    <div class="w-full max-w-sm p-6 sm:p-8 space-y-6 rounded-2xl shadow-xl border border-white/20"><div class="text-center"><h2 class="text-2xl sm:text-3xl font-extrabold" id="userDataTitle">لنبني ملفك السريع</h2><p class="text-white/80 mt-2" id="userDataSubtitle">نحتاج بعض المعلومات للبدء</p></div>
        <div class="space-y-4">
            <div class="relative">
                <span class="absolute inset-y-0 end-0 flex items-center pe-5 pointer-events-none">
                    <svg class="w-5 h-5 text-white/70" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                </span>
                <input type="text" id="userName" class="block w-full rounded-full py-3.5 ps-4 pe-12 bg-white/10 border-2 border-transparent text-white placeholder-white/70 focus:bg-white/20 focus:border-accent focus:ring-0 outline-none transition" placeholder="اكتب اسمك هنا">
            </div>
            <div class="relative">
                <span class="absolute inset-y-0 end-0 flex items-center pe-5 pointer-events-none">
                    <svg class="w-5 h-5 text-white/70" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                </span>
                <input type="text" inputmode="numeric" id="userAge" class="block w-full rounded-full py-3.5 ps-4 pe-12 bg-white/10 border-2 border-transparent text-white placeholder-white/70 focus:bg-white/20 focus:border-accent focus:ring-0 outline-none transition" placeholder="عمرك">
            </div>
            <div class="relative">
                <span class="absolute inset-y-0 end-0 flex items-center pe-5 pointer-events-none">
                    <svg class="w-5 h-5 text-white/70" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                </span>
                <input type="text" id="userCountry" class="block w-full rounded-full py-3.5 ps-4 pe-12 bg-white/10 border-2 border-transparent text-white placeholder-white/70 focus:bg-white/20 focus:border-accent focus:ring-0 outline-none transition" placeholder="بلدك">
            </div>
        </div>
    <button id="nextBtn" class="cta-btn w-full mt-4 !py-3 !text-lg !font-bold">ابدأ المحادثة</button></div>
  </div>

  <div class="flex flex-col h-full hidden" id="chatContainer">
    <div class="chat-header">
      <div class="brand flex items-center gap-3"><img id="chatAvatar" src="https://images.unsplash.com/photo-1581009137042-c552e485697a?auto=format&fit=crop&w=80&q=80" alt="Coach Avatar" class="rounded-full object-cover"/><span class="text-lg font-bold" id="chatTitle">مدربك الشخصي الذكي</span></div>
      <div class="flex items-center gap-1">
        <button id="resetBtn" class="icon-btn text-xl !w-9 !h-9" title="ابدأ من جديد">
            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18m-2 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
        </button>
        <button id="btnLang" class="lang-toggle-btn icon-btn text-sm font-bold !w-auto px-4 !h-9">AR</button>
        <button id="btnTheme" class="icon-btn text-xl !w-9 !h-9">☀️</button>
      </div>
    </div>
    
    <div id="pinnedMessageArea">
      <div class="pinned-content">
        <div class="flex items-center gap-2 min-w-0">
          <svg class="w-4 h-4 text-gray-500 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 3a1 1 0 0 1 1 1v5.268l2.999 2.999a1 1 0 0 1 .326 1.638l-.11.094L18 16.223V18a1 1 0 0 1-.993.994L17 19h-4.172l-3.535 3.536a1 1 0 0 1-1.497-1.32l.083-.094L11.414 18H8a1 1 0 0 1-1-1v-1.777l-2.173-2.173a1 1 0 0 1-.094-1.548l.094-.11L7.828 9.268V4a1 1 0 0 1 .993-.994L9 3h7z"/></svg>
          <p id="pinnedText" class="pinned-text"></p>
        </div>
        <button id="unpinBtn" class="icon-btn !w-6 !h-6" title="إلغاء التثبيت">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
      </div>
    </div>

    <div class="chat-messages" id="chatMessages" role="log" aria-live="polite"></div>
    
    <div class="input-area-wrapper">
        <div id="planButtonArea" class="px-2 pb-2"><div class="dynamic-card !m-0 rounded-xl p-3 flex justify-between items-center flex-wrap sm:flex-nowrap gap-3 bg-white dark:bg-slate-800"><div class="min-w-0"><div id="ctaTitle" class="font-bold text-gray-800 dark:text-gray-100">جاهز لنتيجة ملموسة؟</div><div id="ctaSubtitle" class="text-sm text-gray-600 dark:text-gray-300 mt-1">خطة مُحكمة + متابعة أسبوعية.</div></div><button id="generatePlanBtn" class="cta-btn cta-btn-animated !text-sm !px-5 !py-2.5 w-full sm:w-auto" disabled>احصل على خطتك الآن</button></div></div>
        <div id="imagePreviewsWrapper" class="hidden">
            <div id="imagePreviewsContainer"></div>
        </div>
        <div class="input-area" id="inputArea"><div class="input-field-container"><button id="plusBtn" class="icon-btn" aria-label="أرسل صورة/ملف" title="صورة/ملف"><svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg></button><input type="file" id="fileInput" accept="image/*" class="hidden" multiple /><textarea id="userInput" placeholder="اكتب رسالتك..." dir="rtl" rows="1"></textarea><button id="micBtn" class="icon-btn mic-btn" aria-label="تسجيل صوتي" title="اضغط مطولاً للتسجيل"><svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line></svg></button></div><button id="sendBtn" class="icon-btn send-btn" aria-label="أرسل" title="إرسال"><svg class="w-5 h-5" style="transform: translateX(1px);" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg></button></div>
        <div class="hidden text-center" id="recHintWrap"><p class="rec-hint text-xs" id="recHint"></p></div>
    </div>
    
    <div id="appFooter" class="p-2 text-center border-t border-[var(--color-border)] bg-[var(--color-bg-surface)] flex-shrink-0">
        <p class="text-xs text-[var(--color-text-secondary)]">
            <span id="footerRights"></span> |  
            <a href="https://buymeacoffee.com/aipersonaltrainer" target="_blank" class="font-semibold text-[var(--color-accent)] hover:underline">
                ☕ <span id="footerCoffee"></span>
            </a> | 
            <a href="#" id="howToUseLink" class="font-semibold underline hover:text-[var(--color-accent)] transition-colors">
                <span id="howToUseText"></span>
            </a>
        </p>
    </div>
  </div>

  <div id="profileModal" class="modal" aria-modal="true" aria-hidden="true" role="dialog">
    <div class="modal-content !w-full !max-w-md !rounded-none sm:!rounded-2xl p-0 overflow-hidden">
      <div class="bg-gray-100 dark:bg-gray-800 p-4 flex justify-end">
        <button id="closeProfileBtn" class="icon-btn !w-8 !h-8" title="إغلاق">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
      </div>
      <div class="flex flex-col items-center p-6 bg-gray-100 dark:bg-gray-800">
        <img src="https://images.unsplash.com/photo-1581009137042-c552e485697a?auto=format&fit=crop&w=150&q=80" alt="Coach Avatar" class="w-36 h-36 rounded-full object-cover border-4 border-white dark:border-gray-700 shadow-lg"/>
        <h3 class="text-2xl font-bold mt-4" id="profileName">الكابتن مصطفى الصافي</h3>
        <p class="text-lg text-gray-500 dark:text-gray-400" id="profilePhone"></p>
        <div class="flex gap-4 mt-4 justify-center">
          <a href="https://wa.me/971502061209" target="_blank" class="icon-btn !w-12 !h-12 bg-green-500 !text-white hover:bg-green-600 shadow-md" title="WhatsApp">
            <svg class="w-6 h-6" viewBox="0 0 32 32" fill="currentColor"><path d="M19.11 17.18c-.28-.14-1.65-.81-1.9-.9-.26-.1-.44-.14-.62.14-.18.27-.71.9-.87 1.09-.16.18-.32.2-.6.07-.28-.14-1.18-.44-2.25-1.4-.83-.74-1.39-1.66-1.55-1.94-.16-.27-.02-.42.12-.56.12-.12.28-.3.42-.46.14-.16.18-.27.28-.46.1-.18.06-.34-.02-.48-.08-.14-.62-1.5-.84-2.06-.22-.52-.44-.45-.62-.46h-.54c-.18 0-.48.07-.74.34-.26.27-1 1-1 2.42s1.03 2.8 1.18 2.99c.14.2 2.03 3.1 4.93 4.33.69.3 1.22.48 1.64.62.69.22 1.32.19 1.82.12.56-.08 1.65-.68 1.88-1.35.24-.67.24-1.24.16-1.35-.06-.1-.24-.16-.52-.3z"/><path d="M26.9 5.1A13.9 13.9 0 0 0 16 .1C7.3.1.2 7.1.2 15.8c0 2.7.7 5.2 2 7.4L.1 31.9l8.9-2.3c2.1 1.1 4.5 1.7 7 1.7h.1c8.7 0 15.8-7 15.8-15.7 0-4.2-1.6-8.1-4.9-10.9z"/></svg>
          </a>
          <a href="tel:+971502061209" class="icon-btn !w-12 !h-12 bg-blue-500 !text-white hover:bg-blue-600 shadow-md" title="اتصال">
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M6.62 10.79a15.05 15.05 0 0 0 6.59 6.59l2.2-2.2a1 1 0 0 1 1.01-.24c1.11.37 2.3.57 3.58.57a1 1 0 0 1 1 1V21a1 1 0 0 1-1 1C10.61 22 2 13.39 2 3a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1c0 1.27.2 2.47.57 3.58a1 1 0 0 1-.24 1.01l-2.21 2.2z"/></svg>
          </a>
        </div>
      </div>
      <div class="p-6 bg-white dark:bg-gray-900 space-y-4">
        <div>
          <h4 class="text-sm font-bold text-green-600 dark:text-green-400" id="profileBioTitle">About</h4>
          <p class="mt-1 text-gray-700 dark:text-gray-300" id="profileBioText">خبير دولي حاصل على دبلومة متقدمة في اللياقة البدنية والتغذية من كاليفورnia. أصمم لك نظام حياة متكامل لتحقيق أهدافك بكفاءة ودقة.</p>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
          <button id="profileGetPlanBtn" class="cta-btn w-full !py-3 !text-base !font-bold">احصل على خطتك</button>
          <a href="https://buymeacoffee.com/aipersonaltrainer" target="_blank" class="inline-flex items-center justify-center gap-2 px-5 py-2.5 font-bold text-gray-800 bg-amber-400 rounded-lg shadow-md hover:bg-amber-500 transition-colors">
            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 3H4v10c0 2.21 1.79 4 4 4h6c2.21 0 4-1.79 4-4v-3h2c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2zm0 5h-2V5h2v3zM4 19h16v2H4v-2z"/></svg>
            <span id="coffeeBtnText2">ادعمني بقهوة</span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <div id="contactModal" class="modal" aria-modal="true" aria-hidden="true" role="dialog"><div class="modal-content"><div class="modal-header p-4 flex justify-between items-center"><h3 id="contactModalTitle" class="text-lg font-bold">احصل على خطتك الآن</h3><button id="closeContactBtn" class="icon-btn !w-8 !h-8" title="إغلاق">×</button></div><div class="modal-body p-6"><p id="contactModalText1" class="mb-4 text-secondary">اختر الطريقة المناسبة للتواصل المباشر مع المدرب.</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3"><a class="flex items-center justify-center gap-3 p-4 rounded-lg bg-[#25D366] text-white font-bold transition hover:opacity-90" href="https://wa.me/971502061209" target="_blank" rel="noopener"><svg class="w-6 h-6" viewBox="0 0 32 32" fill="currentColor"><path d="M19.11 17.18c-.28-.14-1.65-.81-1.9-.9-.26-.1-.44-.14-.62.14-.18.27-.71.9-.87 1.09-.16.18-.32.2-.6.07-.28-.14-1.18-.44-2.25-1.4-.83-.74-1.39-1.66-1.55-1.94-.16-.27-.02-.42.12-.56.12-.12.28-.3.42-.46.14-.16.18-.27.28-.46.1-.18.06-.34-.02-.48-.08-.14-.62-1.5-.84-2.06-.22-.52-.44-.45-.62-.46h-.54c-.18 0-.48.07-.74.34-.26.27-1 1-1 2.42s1.03 2.8 1.18 2.99c.14.2 2.03 3.1 4.93 4.33.69.3 1.22.48 1.64.62.69.22 1.32.19 1.82.12.56-.08 1.65-.68 1.88-1.35.24-.67.24-1.24.16-1.35-.06-.1-.24-.16-.52-.3z"/><path d="M26.9 5.1A13.9 13.9 0 0 0 16 .1C7.3.1.2 7.1.2 15.8c0 2.7.7 5.2 2 7.4L.1 31.9l8.9-2.3c2.1 1.1 4.5 1.7 7 1.7h.1c8.7 0 15.8-7 15.8-15.7 0-4.2-1.6-8.1-4.9-10.9z"/></svg><span id="whatsappBtnText">واتساب</span></a><a class="flex items-center justify-center gap-3 p-4 rounded-lg bg-blue-500 text-white font-bold transition hover:opacity-90" href="tel:+971502061209"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M6.62 10.79a15.05 15.05 0 0 0 6.59 6.59l2.2-2.2a1 1 0 0 1 1.01-.24c1.11.37 2.3.57 3.58.57a1 1 0 0 1 1 1V21a1 1 0 0 1-1 1C10.61 22 2 13.39 2 3a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1c0 1.27.2 2.47.57 3.58a1 1 0 0 1-.24 1.01l-2.21 2.2z"/></svg><span id="phoneBtnText">اتصال</span></a></div><div id="iherb-card" class="dynamic-card mt-6 pt-5 border-t border-[var(--color-border)] flex flex-col sm:flex-row items-center gap-4 p-4 !m-0 !border-0 !shadow-none"><div class="flex-shrink-0 grid place-items-center w-14 h-14 rounded-full bg-emerald-100 dark:bg-emerald-900 text-[var(--color-accent)]"><svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17 8C8 10 5.9 16.17 3.82 21.34l1.89.66.95-2.3c.48.17.98.3 1.5.38 3.3.5 6.22-2.39 6.84-5.64.45-2.3-1.05-4.42-3.23-5.32-.6-.25-1.25-.37-1.92-.37-.85 0-1.67.2-2.43.56l-1.89-.66C7.9 3.83 17 8 17 8Z" /></svg></div><div class="flex-1 min-w-0 text-center sm:text-right"><p id="iherbTitle" class="font-extrabold text-emerald-800 dark:text-emerald-200">احصل على مكملاتك من iHerb</p><p id="iherbSubtitle" class="text-sm text-emerald-700 dark:text-emerald-300 mt-1">خصم 10% إضافي هدية من مدربك!</p></div><div class="flex items-center gap-2 mt-2 sm:mt-0">
        <div id="iherb-code" title="اضغط للنسخ" class="cursor-pointer transition-transform hover:scale-105 px-4 py-2 rounded-lg bg-white dark:bg-gray-800 border-2 border-dashed border-[var(--color-accent)] font-mono text-base font-bold text-emerald-700 dark:text-emerald-300">AYT3413</div>
        <a id="copy-and-go-iherb-btn" href="https://iherb.co/fL9KCv1i?rcode=AYT3413" target="_blank" class="flex-shrink-0 px-4 py-2.5 rounded-lg bg-[var(--color-accent)] text-white font-bold hover:bg-[var(--color-accent-hover)] transition-colors text-sm shadow-md"><span id="copy-and-go-iherb-btn-text">اذهب للمتجر</span></a></div></div><div class="text-center mt-6 pt-5 border-t border-[var(--color-border)]"><p id="coffeeText" class="text-sm text-secondary mb-3">هل أعجبتك الأداة؟ دعمك يساعدنا على الاستمرار.</p><a href="https://buymeacoffee.com/aipersonaltrainer" target="_blank" class="inline-flex items-center gap-2 px-5 py-2.5 font-bold text-gray-800 bg-amber-400 rounded-lg shadow-md hover:bg-amber-500 transition-colors"><svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 3H4v10c0 2.21 1.79 4 4 4h6c2.21 0 4-1.79 4-4v-3h2c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2zm0 5h-2V5h2v3zM4 19h16v2H4v-2z"/></svg><span id="coffeeBtnText">ادعمني بقهوة</span></a></div></div></div></div>

  <div id="resetConfirmModal" class="modal" aria-modal="true" aria-hidden="true" role="dialog">
      <div class="modal-content !max-w-sm">
          <div class="p-6">
              <h3 class="text-lg font-bold" id="resetModalTitle">تأكيد الحذف</h3>
              <p class="text-secondary mt-2" id="resetModalText">هل أنت متأكد أنك تريد حذف كل الرسائل والبدء من جديد؟</p>
          </div>
          <div class="flex justify-end gap-3 p-4 bg-gray-50 dark:bg-gray-800 rounded-b-xl">
              <button id="cancelResetBtn" class="px-4 py-2 rounded-lg font-semibold bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition !text-black" id="resetCancelBtn">إلغاء</button>
              <button id="confirmResetBtn" class="px-4 py-2 rounded-lg font-semibold text-white bg-red-500 hover:bg-red-600 transition" id="resetConfirmBtn">موافق</button>
          </div>
      </div>
  </div>

  <div id="messageContextMenu">
      <button class="context-menu-btn" data-action="copy">
          <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
          <span id="contextCopy">نسخ</span>
      </button>
      <button class="context-menu-btn" data-action="share">
          <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
          <span id="contextShare">مشاركة</span>
      </button>
      <button class="context-menu-btn" data-action="pin">
          <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 3a1 1 0 0 1 1 1v5.268l2.999 2.999a1 1 0 0 1 .326 1.638l-.11.094L18 16.223V18a1 1 0 0 1-.993.994L17 19h-4.172l-3.535 3.536a1 1 0 0 1-1.497-1.32l.083-.094L11.414 18H8a1 1 0 0 1-1-1v-1.777l-2.173-2.173a1 1 0 0 1-.094-1.548l.094-.11L7.828 9.268V4a1 1 0 0 1 .993-.994L9 3h7z"/></svg>
          <span id="contextPin">تثبيت</span>
      </button>
      <div class="context-menu-separator" data-role="separator"></div>
      <button class="context-menu-btn" data-action="edit" data-role="user-only">
          <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
          <span id="contextEdit">تعديل</span>
      </button>
      <button class="context-menu-btn" data-action="delete" data-role="user-only">
          <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
          <span id="contextDelete">حذف</span>
      </button>
  </div>
  
  <div id="imageViewerModal" class="modal" aria-modal="true" aria-hidden="true" role="dialog">
    <div class="modal-content !w-auto !max-w-[90vw] !max-h-[90vh] !p-2 !bg-transparent !shadow-none relative">
      <img id="fullImageView" src="" alt="Full size preview" class="max-w-full max-h-full object-contain">
      <button id="closeImageViewerBtn" class="absolute top-0 right-0 icon-btn !w-10 !h-10 bg-black/50 !text-white hover:bg-black/75" title="إغلاق">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      </button>
    </div>
  </div>

  <div id="howToUseModal" class="modal" aria-modal="true" aria-hidden="true" role="dialog">
    <div class="modal-content">
        <div class="modal-header p-4 flex justify-between items-center">
            <h3 id="howToUseTitle" class="text-lg font-bold"></h3>
            <button id="closeHowToUseBtn" class="icon-btn !w-8 !h-8" title="إغلاق">×</button>
        </div>
        <div class="p-6 space-y-4 overflow-y-auto max-h-[70vh]" id="howToUseContent">
            </div>
    </div>
  </div>

  <script type="module" src="script.js" defer></script>
</body>
</html>